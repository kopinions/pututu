{"title":"Linux emacs clangd 配置","date":"2019-10-08T11:09:20.000Z","date_formatted":{"ll":"2019年10月8日","L":"2019/10/08","MM-DD":"10-08"},"link":"2019/10/08/emacs-clangd-config","tags":["emacs"],"categories":["emacs"],"updated":"2022-09-29T15:48:22.609Z","content":"<h3 id=\"准备工作\">准备工作<a title=\"#准备工作\" href=\"#准备工作\"></a></h3>\n<p>笔者的因为工作的原因需要使用 centos 工作， 并且工作的主要语言是 c/c++, 但是笔者比较习惯的 IDE 是 Intellij 或者 emacs。 所以笔者需要在 centos 上配置相应的 emacs 环境。但是在<br>\ncentos 上使用 yum 安装 emacs 下只能安装 emacs 24.2, 所以笔者需要配置 emacs ,并且配置 emacs c++ 的环境。</p>\n<h3 id=\"compile-emacs\">compile emacs<a title=\"#compile-emacs\" href=\"#compile-emacs\"></a></h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xf emacs-26.3.tar.xz</span><br><span class=\"line\">cd emacs-26.3</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"compile-llvm-9.0.0\">compile llvm 9.0.0<a title=\"#compile-llvm-9.0.0\" href=\"#compile-llvm-9.0.0\"></a></h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -sjklL https://github.com/llvm/llvm-project/archive/llvmorg-9.0.0.tar.gz -O llvmorg.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxf llvmorg.tar.xz --transform s/llvmorg-9.0.0/llvmorg/</span><br><span class=\"line\">cd llvmorg</span><br><span class=\"line\">mkdir build</span><br><span class=\"line\">cd build</span><br><span class=\"line\">cmake -G &quot;Unix Makefiles&quot;  -DLLVM_TEMPORARILY_ALLOW_OLD_TOOLCHAIN=true -DLLVM_ENABLE_PROJECTS=&quot;clang-tools-extra&quot; -DCMAKE_BUILD_TYPE=MinSizeRel ../llvm</span><br><span class=\"line\">make -j8</span><br></pre></td></tr></table></figure>\n<h3 id=\"遇到的问题\">遇到的问题<a title=\"#遇到的问题\" href=\"#遇到的问题\"></a></h3>\n<h5 id=\"collect2:-error:-ld-terminated-with-signal-9-[killed]\">collect2: error: ld terminated with signal 9 [Killed]<a title=\"#collect2:-error:-ld-terminated-with-signal-9-[killed]\" href=\"#collect2:-error:-ld-terminated-with-signal-9-[killed]\"></a></h5>\n<p>这个问题出现的元应主要是因为， llvm c++ 写的大型应用，在链接阶段，非常消耗内存，这种情况下如果内存不够用，会导致 link 进程被杀死。解决办法就是增加<br>\nswap 分区，用来补齐需要的内存。对于 llvm 的编译，最好让内存和 swap 相加超过 16GB. 创建增加 swap 分区的命令如下所示</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 因为 swap 分区需要较高的权限，直接使用 root 操作</span><br><span class=\"line\"></span><br><span class=\"line\">sudo su</span><br><span class=\"line\">dd -if /dev/zero -of /tmp/swap1 bs=1M count=8192</span><br><span class=\"line\">mkswap /tmp/swap1</span><br><span class=\"line\">swapon /tmp/swap1</span><br><span class=\"line\"># 查看 swap 分区是否变成 8G</span><br><span class=\"line\">free -g</span><br></pre></td></tr></table></figure>\n<h5 id=\"can-not-find-clang-tools-extra,-or-clang\">can not find clang-tools-extra, or clang<a title=\"#can-not-find-clang-tools-extra,-or-clang\" href=\"#can-not-find-clang-tools-extra,-or-clang\"></a></h5>\n<p>这个问题主要是我们目录结构没有遵从 llvm 预期的目录结构放置，导致没有 llvm 没法找到 clang , 和 clang-tools-extra 的代码目录，请严格按照 compile llvm 9.0.0 进行操作</p>\n","prev":{"title":"IOT related 知识","link":"2019/10/20/pcb"},"next":{"title":"RPM 安装包制作","link":"2019/09/12/rpm-package-with-rpmbuild"},"plink":"https://kopinions.com/2019/10/08/emacs-clangd-config/","toc":[{"id":"准备工作","title":"准备工作","index":"1"},{"id":"compile-emacs","title":"compile emacs","index":"2"},{"id":"compile-llvm-9.0.0","title":"compile llvm 9.0.0","index":"3"},{"id":"遇到的问题","title":"遇到的问题","index":"4"}],"reading_time":"434 字约 3 分钟"}