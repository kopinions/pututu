{"title":"如何使用 Heroku 部署应用","date":"2014-07-09T14:14:50.000Z","date_formatted":{"ll":"2014年7月9日","L":"2014/07/09","MM-DD":"07-09"},"link":"2014/07/09/heroku-app-deploy","tags":["devops"],"categories":["devops"],"updated":"2022-09-29T15:48:22.609Z","content":"<p>如何使用Heroku来部署一个新的应用</p>\n<h3 id=\"1.-申请账号\">1. 申请账号<a title=\"#1.-申请账号\" href=\"#1.-申请账号\"></a></h3>\n<h3 id=\"2.-登录账号创建一个项目\">2. 登录账号创建一个项目<a title=\"#2.-登录账号创建一个项目\" href=\"#2.-登录账号创建一个项目\"></a></h3>\n<p>可以使用下面的命令来创建一个新的App</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">heroku create</span><br></pre></td></tr></table></figure>\n<p>但是为了不要让hero来创建一个随便什么名字的app，我们可以登录到heroku上新创建一个项目，myapp，然后拿到你新创建的git repository的地址 <a href=\"mailto:git@heroku.com\">git@heroku.com</a>:myapp.git</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote add heroku git@heroku.com:myapp.git  </span><br><span class=\"line\">git push heroku master</span><br></pre></td></tr></table></figure>\n<p>此处需要注意一个问题：heroku会搜索git repo的root directory来找到相应项目的配置文件，来初始化我们的项目。比如rails就会在根目录下找Gemfile，如果是nodejs项目，就会在根目录下寻找package.json. 但是如果我们的项目不在根目录就可以通过以下方法解决.详情请看<a href=\"http://apenwarr.ca/log/?m=200904#30\" target=\"_blank\">git subtree</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--/</span><br><span class=\"line\">----/.git</span><br><span class=\"line\">----/build</span><br><span class=\"line\">----/myapp</span><br><span class=\"line\">----/----/requirements.txt</span><br><span class=\"line\"></span><br><span class=\"line\">git subtree push --prefix myapp heroku master</span><br></pre></td></tr></table></figure>\n<p>通过这种方式提交的代码，是不能通过git subtree push --prefix myapp heroku master 再次提交到heroku上的，<br>\n总会出现以下提示：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rror: failed to push some refs to &#x27;git@heroku.com:askleave.git&#x27;</span><br><span class=\"line\">hint: Updates were rejected because a pushed branch tip is behind its remote</span><br><span class=\"line\">hint: counterpart. Check out this branch and integrate the remote changes</span><br><span class=\"line\">hint: (e.g. &#x27;git pull ...&#x27;) before pushing again.</span><br></pre></td></tr></table></figure>\n<p>此时可以尝试用以下方式提交</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push heroku `git subtree split --prefix pythonapp master`:master --force</span><br></pre></td></tr></table></figure>\n<h3 id=\"3.-安装postgres\">3. 安装postgres<a title=\"#3.-安装postgres\" href=\"#3.-安装postgres\"></a></h3>\n<p>因为heroku不支持sqllite数据库，所以此时我们需要使用其他的数据库。我们可以使用heroku来提供的postgresql。使用下面命令安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">heroku addons:add heroku-postgresql --app=myapp</span><br></pre></td></tr></table></figure>\n<h3 id=\"4.-配置\">4. 配置<a title=\"#4.-配置\" href=\"#4.-配置\"></a></h3>\n<p>此时我们使用的postgresql虽然已经安装好了，但是却没有做正确的设置，所以此时我们需要对我们db进行配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">heroku  run --app=myapp rake db:migrate</span><br></pre></td></tr></table></figure>\n<h3 id=\"5.-运维\">5. 运维<a title=\"#5.-运维\" href=\"#5.-运维\"></a></h3>\n<p>可以使用下面的命令来查看服务器实时的日志信息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">heroku logs --tail --app=myapp</span><br></pre></td></tr></table></figure>\n<h3 id=\"6.-更多的配置\">6. 更多的配置<a title=\"#6.-更多的配置\" href=\"#6.-更多的配置\"></a></h3>\n<p>Procfile</p>\n<p>详细的其他信息请参考<a href=\"https://devcenter.heroku.com/articles/getting-started-with-rails4\" target=\"_blank\">Getting started with rails4</a></p>\n","prev":{"title":"时间驱动建模","link":"2014/07/20/accounting-driven-modeling"},"next":{"title":"ruby 入门","link":"2014/07/08/ruby-peek"},"plink":"https://kopinions.com/2014/07/09/heroku-app-deploy/","toc":[{"id":"1.-申请账号","title":"1. 申请账号","index":"1"},{"id":"2.-登录账号创建一个项目","title":"2. 登录账号创建一个项目","index":"2"},{"id":"3.-安装postgres","title":"3. 安装postgres","index":"3"},{"id":"4.-配置","title":"4. 配置","index":"4"},{"id":"5.-运维","title":"5. 运维","index":"5"},{"id":"6.-更多的配置","title":"6. 更多的配置","index":"6"}],"reading_time":"517 字约 3 分钟"}